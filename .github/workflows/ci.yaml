name: Integration Test

# on:
#   push:
#     branches:
#       - master
#   pull_request: 

on: push

jobs:
  build:
    env:
      # I'd love to use a cleaner path, but GitHub actions won't let you use anythingÂ above
      # /home/runner/work/mux-go/mux-go/, so /home/runner/work/mux-go/mux-go/go it is!
      GOPATH: /home/runner/work/mux-go/mux-go/go
    name: Integration Test
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
          path: /home/runner/work/mux-go/mux-go/go/src/github.com/muxinc/mux-go
      - name: Install Go
        uses: actions/setup-go@v2
      - name: Install Dep
        run: |
          mkdir -p /home/runner/work/mux-go/mux-go/go/bin
          curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
      - name: Install Go Dependencies
        run: |
          cd /home/runner/work/mux-go/mux-go/go/src/github.com/muxinc/mux-go
          export PATH=$PATH:$(go env GOPATH)/bin
          dep ensure
      - name: Run Integration Tests
        run: |
          cd /home/runner/work/mux-go/mux-go/go/src/github.com/muxinc/mux-go
          bash test.sh
        env: 
          MUX_TOKEN_ID: ${{ secrets.MUX_TOKEN_ID }}
          MUX_TOKEN_SECRET: ${{ secrets.MUX_TOKEN_SECRET }}
